<!doctype html><html lang=en><head><title>RDS Snapshot → S3: Diagnose and Fix a Disabled Export</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.405d7f92a8dc58b16aec857858b3f63df64fa4178ad22c80fa08fda2ac4db0f7.css integrity="sha256-QF1/kqjcWLFq7IV4WLP2PfZPpBeK0iyA+gj9oqxNsPc="><meta property="og:title" content="Nicolás Serbin Blog"><meta property="og:type" content="website"><meta property="og:description" content="Nicolás Serbin Portfolio & Blog."><meta property="og:image" content="/images/author/perfil.png"><meta property="og:url" content="https://nserbin.github.io/"><meta name=description content="When the Export to S3 button is greyed out, stop guessing. Confirm the cause in 60 seconds, restore into a temporary gp3 instance, re-snapshot, and export with the right IAM/KMS wiring."><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/>Nicolas Serbin's</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#education>Education</a></li><li class=nav-item><a class=nav-link href=/#languages>Languages</a></li><li class=nav-item><a class=nav-link href=/#projects>Projects</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/#accomplishments>Courses</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/aws/aws-rds/export-to-s3><span class="fi fi-gb"></span>
English
</a><a class="dropdown-item nav-link languages-item" href=/es/posts/aws/aws-rds/export-to-s3><span class="fi fi-ar"></span>
Spanish</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/aws/> AWS</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/posts/aws/aws-networking/> Networking</a><ul><li><a class=list-link href=/posts/aws/aws-networking/from-nginx-to-alb/ title="Migrating from NGINX to ALB">Migrating from NGINX to ALB</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/aws/aws-rds/> RDS</a><ul class=active><li><a class="active list-link" href=/posts/aws/aws-rds/export-to-s3/ title="RDS Snapshot → S3 (Fix Disabled Export)">RDS Snapshot → S3 (Fix Disabled Export)</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/posts/rds-to-s3.webp)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/perfil_hu_2cfaf1d644cfea1f.png alt="Author Image"><h5 class=author-name>Nicolás Serbin</h5><p class=text-muted>Wednesday, August 27, 2025</p></div><div class=title><h1>RDS Snapshot → S3: Diagnose and Fix a Disabled Export</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/tags/s3/ class="btn btn-sm btn-info">S3</a></li><li class=rounded><a href=/tags/rds/ class="btn btn-sm btn-info">RDS</a></li><li class=rounded><a href=/tags/storage-type/ class="btn btn-sm btn-info">Storage Type</a></li><li class=rounded><a href=/tags/export-to-s3/ class="btn btn-sm btn-info">Export to S3</a></li><li class=rounded><a href=/tags/snapshot/ class="btn btn-sm btn-info">Snapshot</a></li></ul></div><div class=post-content id=post-content><p>Before diving into the why and how, here’s what we deliver:</p><ul><li><p>⏱️ Clear diagnosis in under a minute (no console guesswork)</p></li><li><p>🫥 Non-intrusive path: <strong>temporary</strong> instance only (we don’t touch your current RDS)</p></li><li><p>🔐 Export that works, with the correct <strong>IAM/KMS</strong> shape</p></li><li><p>✅ Copy-paste commands for your runbook or CI</p></li></ul><div style=margin-top:2rem></div><div class="alert success"><span><i data-feather=check-circle></i></span>
<span><strong>All of this without modifying your existing DB instance — restore the snapshot into a temporary <strong>gp3</strong> instance 🚀, create a new snapshot 📸, and export that one 📦.</strong></span></div><div style=margin-top:4rem></div><h2 id=-why-the-export-is-disabled>🔒 Why the export is disabled</h2><p><div style=margin-top:1rem></div>The most frequent blocker is simple: the snapshot was taken from an instance on <strong>magnetic storage</strong>. Snapshots with that lineage aren’t eligible for export. The console is vague; the CLI tells you exactly what’s going on.</p><div style=margin-top:4rem></div><h2 id=-console-vs-cli-what-actually-helps>⚖️ Console vs CLI: what actually helps</h2><div style=margin-top:2rem></div><div style=display:flex;justify-content:center><table><thead><tr><th></th><th>❌ Console only</th><th>✅ CLI runbook</th></tr></thead><tbody><tr><td><strong>Feedback</strong></td><td>Greyed-out button, no reason why</td><td>Explicit status & fields (StorageType, errors)</td></tr><tr><td><strong>Actions</strong></td><td>Trial and error</td><td>Deterministic flow (restore → snapshot → export)</td></tr><tr><td><strong>Repeatability</strong></td><td>Manual steps</td><td>Scriptable & auditable</td></tr></tbody></table></div><div style=margin-top:4rem></div><h2 id=-fast-diagnosis-cli>🕵️‍♂️ Fast diagnosis (CLI)</h2><p><div style=margin-top:2rem></div><strong>Check the snapshot storage type:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws rds describe-db-snapshots <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-snapshot-identifier &lt;SNAPSHOT_ID&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#39;DBSnapshots[0].[DBSnapshotIdentifier,Engine,EngineVersion,StorageType,Encrypted,Status]&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output table
</span></span></code></pre></div><p><div style=margin-top:2rem></div><div class="alert warning"><span><i data-feather=alert-triangle></i></span>
<span><strong>If StorageType = <em>standard</em>, that snapshot won’t export.</strong></span></div></p><div style=margin-top:4rem></div><h2 id=-architecture-at-a-glance>🧭 Architecture at a glance</h2><p>The flow is straightforward: restore snapshot → temporary gp3 instance → new snapshot → export to S3 with an <strong>export role</strong> trusted by <code>export.rds.amazonaws.com</code>.</p><div style=margin-top:2rem></div><img src=/images/posts/diagram-rds-export-s3.png alt="End-to-end flow to unblock RDS snapshot export to S3" class=center><div style=margin-top:2rem></div><p>This shows:</p><ul><li><p>🔁 Where the storage lineage changes (magnetic → gp3)</p></li><li><p>🔗 How the export service assumes an IAM role to write to S3</p></li><li><p>🧰 The minimal moving parts (RDS, S3, IAM, optional KMS)</p></li></ul><div style=margin-top:4rem></div><h2 id=-the-playbook-no-changes-to-your-existing-rds>📘 The playbook (no changes to your existing RDS)</h2><p><div style=margin-top:2rem></div><div class="alert info"><span><i data-feather=info></i></span>
<span><strong>We <strong>do not</strong> modify the current DB instance. We restore the snapshot into a <strong>temporary</strong> SSD-backed instance, create a <strong>new</strong> snapshot, and export that one.</strong></span></div></p><div style=margin-top:2rem></div><h3 id=-restore-the-snapshot-on-gp3-temporary-instance>🧱 Restore the snapshot on <strong>gp3</strong> (temporary instance)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Vars</span>
</span></span><span style=display:flex><span>export REGION<span style=color:#f92672>=</span>&lt;REGION&gt;
</span></span><span style=display:flex><span>export TEMP_DB_ID<span style=color:#f92672>=</span>&lt;TEMP_DB_ID&gt;
</span></span><span style=display:flex><span>export SNAPSHOT_ID<span style=color:#f92672>=</span>&lt;SNAPSHOT_ID&gt;
</span></span><span style=display:flex><span>export SUBNET_GROUP<span style=color:#f92672>=</span>&lt;DB_SUBNET_GROUP&gt;
</span></span><span style=display:flex><span>export SG_ID<span style=color:#f92672>=</span>&lt;SECURITY_GROUP_ID&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws rds restore-db-instance-from-db-snapshot <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --region $REGION <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-instance-identifier $TEMP_DB_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-snapshot-identifier $SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --storage-type gp3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --no-publicly-accessible <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-subnet-group-name $SUBNET_GROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --vpc-security-group-ids $SG_ID
</span></span></code></pre></div><div style=margin-top:2rem></div><h3 id=-create-a-new-snapshot-now-ssd-backed>📸 Create a <strong>new</strong> snapshot (now SSD-backed)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export NEW_SNAPSHOT_ID<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>TEMP_DB_ID<span style=color:#e6db74>}</span>-exportable-<span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws rds create-db-snapshot <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-snapshot-identifier $NEW_SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-instance-identifier $TEMP_DB_ID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sanity check</span>
</span></span><span style=display:flex><span>aws rds describe-db-snapshots <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --db-snapshot-identifier $NEW_SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#39;DBSnapshots[0].[DBSnapshotIdentifier,StorageType,Status]&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output table
</span></span></code></pre></div><div style=margin-top:4rem></div><h2 id=-export-to-s3-the-wiring-that-matters>🧷 Export to S3 (the wiring that matters)</h2><div style=margin-top:2rem></div><h3 id=-requirements>✅ Requirements</h3><ul><li><p>🌍 S3 bucket in the <strong>same region</strong> as the snapshot</p></li><li><p>🤝 <strong>Export IAM role</strong> trusted by <code>export.rds.amazonaws.com</code></p></li><li><p>📝 Role permissions to <strong>write to S3</strong> (PutObject, ListBucket, GetBucketLocation, etc.)</p></li><li><p>🔑 If using KMS, key <strong>Enabled</strong> and allows the export service</p></li><li><p>🛑 No Organization <strong>SCP</strong> blocking <code>rds:StartExportTask</code></p></li></ul><div style=margin-top:3rem></div><h4 id=-trust-policy-assumed-by-the-export-service>👇 Trust policy (assumed by the export service)</h4><div style=margin-top:1rem></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Principal&#34;</span>: { 
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Service&#34;</span>: <span style=color:#e6db74>&#34;export.rds.amazonaws.com&#34;</span> 
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div style=margin-top:3rem></div><h4 id=-minimal-permissions-policy-s3--kms>📜 Minimal permissions policy (S3 + KMS)</h4><div style=margin-top:1rem></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:PutObject*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:AbortMultipartUpload&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketLocation&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:DeleteObject*&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::&lt;BUCKET&gt;&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::&lt;BUCKET&gt;/*&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kms:CreateGrant&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kms:DescribeKey&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kms:Encrypt&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kms:GenerateDataKey*&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;&lt;KMS_KEY_ARN&gt;&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div style=margin-top:3rem></div><h4 id=-bucket-policy-explicit-allow-for-the-role>🧾 Bucket policy (explicit allow for the role)</h4><div style=margin-top:1rem></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Sid&#34;</span>: <span style=color:#e6db74>&#34;AllowRDSExportWrite&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Principal&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;AWS&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:iam::&lt;ACCOUNT_ID&gt;:role/&lt;RDS_EXPORT_ROLE&gt;&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:AbortMultipartUpload&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketLocation&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::&lt;BUCKET&gt;&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::&lt;BUCKET&gt;/*&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div style=margin-top:4rem></div><h3 id=-start-the-export>▶️ Start the export</h3><div style=margin-top:1rem></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws rds start-export-task <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --export-task-identifier export-$NEW_SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --source-arn arn:aws:rds:$REGION:&lt;ACCOUNT_ID&gt;:snapshot:$NEW_SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --s3-bucket-name &lt;BUCKET&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --s3-prefix rds-exports/$NEW_SNAPSHOT_ID/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --iam-role-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:role/&lt;RDS_EXPORT_ROLE&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --kms-key-id &lt;KMS_KEY_ARN&gt;
</span></span></code></pre></div><div style=margin-top:4rem></div><h3 id=-observe-the-run>👀 Observe the run</h3><div style=margin-top:1rem></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws rds describe-export-tasks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --filters Name<span style=color:#f92672>=</span>export-task-identifier,Values<span style=color:#f92672>=</span>export-$NEW_SNAPSHOT_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#39;ExportTasks[0].[Status,ProgressPercentage,S3Bucket,S3Prefix,FailureCause]&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output table
</span></span></code></pre></div><div style=margin-top:4rem></div><h2 id=-troubleshooting-quick-triage>🧯 Troubleshooting (quick triage)</h2><ul><li>🔎 <strong>AccessDenied</strong> → check Organization <strong>SCPs</strong>, caller permissions, and the export role policy</li><li>🧱 <strong>KMSKeyNotAccessible</strong> → key disabled or a deny affecting <code>export.rds.amazonaws.com</code></li><li>🗺️ <strong>BucketRegionError</strong> → snapshot and bucket must be in the <strong>same region</strong></li><li>🤝 <strong>Shared snapshot</strong> → align KMS access/grants cross-account</li></ul><div style=margin-top:4rem></div><h2 id=-lessons-learned>💡 Lessons Learned</h2><ul><li>Don’t rely on the console to explain the “why” — the <strong>CLI</strong> is your source of truth</li><li>Prevent this upfront: standardize on <strong><code>gp3</code></strong> in modules and block <code>standard</code> storage in CI</li><li>Keep a pre-approved <strong>export role</strong> per account/region to avoid one-off IAM changes</li></ul><div style=margin-top:4rem></div><h2 id=-need-help-with-this>🙋‍♂️ Need Help With This?</h2><p>Need help maintaining your RDS setup - keeping backups restorable, snapshot governance tight, etc. ?</p><p>We’ve implemented these patterns across multiple AWS accounts and regions — repeatable, auditable, and low‑touch.</p><p>💬 <a href=https://linkedin.com/in/NSerbin target=_blank rel=noopener>Let’s chat on LinkedIn</a> — happy to help or exchange ideas.<div style=margin-top:4rem></div></p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f&text=RDS%20Snapshot%20%e2%86%92%20S3%3a%20Diagnose%20and%20Fix%20a%20Disabled%20Export&via=Nicolas%20Serbin%27s" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f&title=RDS%20Snapshot%20%e2%86%92%20S3%3a%20Diagnose%20and%20Fix%20a%20Disabled%20Export" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f&title=RDS%20Snapshot%20%e2%86%92%20S3%3a%20Diagnose%20and%20Fix%20a%20Disabled%20Export" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=RDS%20Snapshot%20%e2%86%92%20S3%3a%20Diagnose%20and%20Fix%20a%20Disabled%20Export https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=RDS%20Snapshot%20%e2%86%92%20S3%3a%20Diagnose%20and%20Fix%20a%20Disabled%20Export&body=https%3a%2f%2fnserbin.github.io%2fposts%2faws%2faws-rds%2fexport-to-s3%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/NSerbin/nserbin.github.io/edit/source/content/posts/aws/aws-rds/export-to-s3.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/aws/aws-networking/from-nginx-to-alb/ title="NGINX Out, ALB In - 70% Cheaper Redirects with Zero Servers" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>NGINX Out, ALB In - 70% Cheaper Redirects with Zero Servers</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#-why-the-export-is-disabled>🔒 Why the export is disabled</a></li><li><a href=#-console-vs-cli-what-actually-helps>⚖️ Console vs CLI: what actually helps</a></li><li><a href=#-fast-diagnosis-cli>🕵️‍♂️ Fast diagnosis (CLI)</a></li><li><a href=#-architecture-at-a-glance>🧭 Architecture at a glance</a></li><li><a href=#-the-playbook-no-changes-to-your-existing-rds>📘 The playbook (no changes to your existing RDS)</a><ul><li><a href=#-restore-the-snapshot-on-gp3-temporary-instance>🧱 Restore the snapshot on <strong>gp3</strong> (temporary instance)</a></li><li><a href=#-create-a-new-snapshot-now-ssd-backed>📸 Create a <strong>new</strong> snapshot (now SSD-backed)</a></li></ul></li><li><a href=#-export-to-s3-the-wiring-that-matters>🧷 Export to S3 (the wiring that matters)</a><ul><li><a href=#-requirements>✅ Requirements</a><ul><li><a href=#-trust-policy-assumed-by-the-export-service>👇 Trust policy (assumed by the export service)</a></li><li><a href=#-minimal-permissions-policy-s3--kms>📜 Minimal permissions policy (S3 + KMS)</a></li><li><a href=#-bucket-policy-explicit-allow-for-the-role>🧾 Bucket policy (explicit allow for the role)</a></li></ul></li><li><a href=#-start-the-export>▶️ Start the export</a></li><li><a href=#-observe-the-run>👀 Observe the run</a></li></ul></li><li><a href=#-troubleshooting-quick-triage>🧯 Troubleshooting (quick triage)</a></li><li><a href=#-lessons-learned>💡 Lessons Learned</a></li><li><a href=#-need-help-with-this>🙋‍♂️ Need Help With This?</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#languages>Languages</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://nserbin.github.io/#accomplishments>Courses</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contact@nserbin.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contact@nserbin.com</span></a></li><li><a href=https://github.com/Nserbin target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>Nserbin</span></a></li><li><a href=https://www.linkedin.com/in/nserbin target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Nicolás Serbin</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2025 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.b4ccbe4248fb24a8c4f2609bf3f81b47f34874688a19fd33adf6ccfae38f18e2.js integrity="sha256-tMy+Qkj7JKjE8mCb8/gbR/NIdGiKGf0zrfbM+uOPGOI=" defer></script></body></html>